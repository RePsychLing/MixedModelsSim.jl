<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Rapid Start · MixedModelsSim.jl</title><meta name="title" content="Rapid Start · MixedModelsSim.jl"/><meta property="og:title" content="Rapid Start · MixedModelsSim.jl"/><meta property="twitter:title" content="Rapid Start · MixedModelsSim.jl"/><meta name="description" content="Documentation for MixedModelsSim.jl."/><meta property="og:description" content="Documentation for MixedModelsSim.jl."/><meta property="twitter:description" content="Documentation for MixedModelsSim.jl."/><script data-outdated-warner src="../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL=".."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../assets/documenter.js"></script><script src="../search_index.js"></script><script src="../siteinfo.js"></script><script src="../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-mocha.css" data-theme-name="catppuccin-mocha"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-macchiato.css" data-theme-name="catppuccin-macchiato"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-frappe.css" data-theme-name="catppuccin-frappe"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-latte.css" data-theme-name="catppuccin-latte"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href="../">MixedModelsSim.jl</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><a class="tocitem" href="../">MixedModelsSim.jl</a></li><li class="is-active"><a class="tocitem" href>Rapid Start</a><ul class="internal"><li><a class="tocitem" href="#Assemble-the-Design"><span>Assemble the Design</span></a></li><li><a class="tocitem" href="#Assemble-the-Random-Effects"><span>Assemble the Random Effects</span></a></li><li><a class="tocitem" href="#Assemble-the-Fixed-Effects"><span>Assemble the Fixed Effects</span></a></li><li><a class="tocitem" href="#Simulate"><span>Simulate</span></a></li><li><a class="tocitem" href="#See-your-power-and-profit!"><span>See your power and profit!</span></a></li></ul></li><li><a class="tocitem" href="../simulation_tutorial/">Beginner Friendly Tutorial</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li class="is-active"><a href>Rapid Start</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Rapid Start</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/RePsychLing/MixedModelsSim.jl" title="View the repository on GitHub"><span class="docs-icon fa-brands"></span><span class="docs-label is-hidden-touch">GitHub</span></a><a class="docs-navbar-link" href="https://github.com/RePsychLing/MixedModelsSim.jl/blob/main/docs/src/simulation.md" title="Edit source on GitHub"><span class="docs-icon fa-solid"></span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h1 id="Simulating-an-Experiment-from-Scratch"><a class="docs-heading-anchor" href="#Simulating-an-Experiment-from-Scratch">Simulating an Experiment from Scratch</a><a id="Simulating-an-Experiment-from-Scratch-1"></a><a class="docs-heading-anchor-permalink" href="#Simulating-an-Experiment-from-Scratch" title="Permalink"></a></h1><p>Here is a worked example of simulating a partially crossed design from scratch.</p><p>First, some setup:</p><pre><code class="language-julia hljs">using DataFrames
using MixedModels, MixedModelsSim
using Random</code></pre><h2 id="Assemble-the-Design"><a class="docs-heading-anchor" href="#Assemble-the-Design">Assemble the Design</a><a id="Assemble-the-Design-1"></a><a class="docs-heading-anchor-permalink" href="#Assemble-the-Design" title="Permalink"></a></h2><p>We&#39;re going to do a 2 x 2 x 2 design. For concreteness, let&#39;s think of this as a linguistic design:</p><ul><li><strong>age</strong> <code>old</code> vs. <code>young</code>, <em>between subjects</em></li><li><strong>frequency</strong> <code>high</code> vs. <code>low</code>, <em>between items</em></li><li><strong>context</strong> <code>matched</code> vs. <code>unmatched</code>, <em>within both</em>.</li></ul><p>Further, let&#39;s assume we want 40 subjects and 80 items. We can specify this design as follows:</p><pre><code class="language-julia hljs">n_subj = 40
n_item = 80
subj_btwn = Dict(:age =&gt; [&quot;old&quot;, &quot;young&quot;])
item_btwn = Dict(:frequency =&gt; [&quot;high&quot;, &quot;low&quot;])
both_win = Dict(:context =&gt; [&quot;matched&quot;, &quot;unmatched&quot;])</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">Dict{Symbol, Vector{String}} with 1 entry:
  :context =&gt; [&quot;matched&quot;, &quot;unmatched&quot;]</code></pre><p>and then generate it:</p><pre><code class="language-julia hljs">rng = MersenneTwister(42)  # specify our random number generator for reproducibility
design = simdat_crossed(rng, n_subj, n_item;
                        subj_btwn = subj_btwn,
                        item_btwn = item_btwn,
                        both_win = both_win)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">6400-element Vector{@NamedTuple{subj::String, age::String, item::String, frequency::String, context::String, dv::Float64}}:
 (subj = &quot;S01&quot;, age = &quot;old&quot;, item = &quot;I01&quot;, frequency = &quot;high&quot;, context = &quot;matched&quot;, dv = -0.5560268761463861)
 (subj = &quot;S02&quot;, age = &quot;young&quot;, item = &quot;I01&quot;, frequency = &quot;high&quot;, context = &quot;matched&quot;, dv = -0.444383357109696)
 (subj = &quot;S03&quot;, age = &quot;old&quot;, item = &quot;I01&quot;, frequency = &quot;high&quot;, context = &quot;matched&quot;, dv = 0.027155338009193845)
 (subj = &quot;S04&quot;, age = &quot;young&quot;, item = &quot;I01&quot;, frequency = &quot;high&quot;, context = &quot;matched&quot;, dv = -0.29948409035891055)
 (subj = &quot;S05&quot;, age = &quot;old&quot;, item = &quot;I01&quot;, frequency = &quot;high&quot;, context = &quot;matched&quot;, dv = 1.7778610980573246)
 (subj = &quot;S06&quot;, age = &quot;young&quot;, item = &quot;I01&quot;, frequency = &quot;high&quot;, context = &quot;matched&quot;, dv = -1.14490153172882)
 (subj = &quot;S07&quot;, age = &quot;old&quot;, item = &quot;I01&quot;, frequency = &quot;high&quot;, context = &quot;matched&quot;, dv = -0.46860588216767457)
 (subj = &quot;S08&quot;, age = &quot;young&quot;, item = &quot;I01&quot;, frequency = &quot;high&quot;, context = &quot;matched&quot;, dv = 0.15614346264074028)
 (subj = &quot;S09&quot;, age = &quot;old&quot;, item = &quot;I01&quot;, frequency = &quot;high&quot;, context = &quot;matched&quot;, dv = -2.641991008076796)
 (subj = &quot;S10&quot;, age = &quot;young&quot;, item = &quot;I01&quot;, frequency = &quot;high&quot;, context = &quot;matched&quot;, dv = 1.0033099014594844)
 ⋮
 (subj = &quot;S32&quot;, age = &quot;young&quot;, item = &quot;I80&quot;, frequency = &quot;low&quot;, context = &quot;unmatched&quot;, dv = -0.0720635904250138)
 (subj = &quot;S33&quot;, age = &quot;old&quot;, item = &quot;I80&quot;, frequency = &quot;low&quot;, context = &quot;unmatched&quot;, dv = -0.5636260084084584)
 (subj = &quot;S34&quot;, age = &quot;young&quot;, item = &quot;I80&quot;, frequency = &quot;low&quot;, context = &quot;unmatched&quot;, dv = -0.48302653966207154)
 (subj = &quot;S35&quot;, age = &quot;old&quot;, item = &quot;I80&quot;, frequency = &quot;low&quot;, context = &quot;unmatched&quot;, dv = 0.5635515836664501)
 (subj = &quot;S36&quot;, age = &quot;young&quot;, item = &quot;I80&quot;, frequency = &quot;low&quot;, context = &quot;unmatched&quot;, dv = -1.5342115330081054)
 (subj = &quot;S37&quot;, age = &quot;old&quot;, item = &quot;I80&quot;, frequency = &quot;low&quot;, context = &quot;unmatched&quot;, dv = -0.7925886663164663)
 (subj = &quot;S38&quot;, age = &quot;young&quot;, item = &quot;I80&quot;, frequency = &quot;low&quot;, context = &quot;unmatched&quot;, dv = 1.1344191438635207)
 (subj = &quot;S39&quot;, age = &quot;old&quot;, item = &quot;I80&quot;, frequency = &quot;low&quot;, context = &quot;unmatched&quot;, dv = 1.3406462534138157)
 (subj = &quot;S40&quot;, age = &quot;young&quot;, item = &quot;I80&quot;, frequency = &quot;low&quot;, context = &quot;unmatched&quot;, dv = 0.7969024201220799)</code></pre><p>Note that <code>simdat_crossed</code> returns a row table, which <code>MixedModels.jl</code> can process directly. For nicely displaying it, we can again use <code>pretty_table</code>:</p><pre><code class="language-julia hljs">pretty_table(first(design, 5))</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">┌────────┬────────┬────────┬───────────┬─────────┬───────────┐
│<span class="sgr1">   subj </span>│<span class="sgr1">    age </span>│<span class="sgr1">   item </span>│<span class="sgr1"> frequency </span>│<span class="sgr1"> context </span>│<span class="sgr1">        dv </span>│
│<span class="sgr90"> String </span>│<span class="sgr90"> String </span>│<span class="sgr90"> String </span>│<span class="sgr90">    String </span>│<span class="sgr90">  String </span>│<span class="sgr90">   Float64 </span>│
├────────┼────────┼────────┼───────────┼─────────┼───────────┤
│    S01 │    old │    I01 │      high │ matched │ -0.556027 │
│    S02 │  young │    I01 │      high │ matched │ -0.444383 │
│    S03 │    old │    I01 │      high │ matched │ 0.0271553 │
│    S04 │  young │    I01 │      high │ matched │ -0.299484 │
│    S05 │    old │    I01 │      high │ matched │   1.77786 │
└────────┴────────┴────────┴───────────┴─────────┴───────────┘</code></pre><p>We can also convert it to a DataFrame and change the factors to use pooled arrays to save a bit of memory.</p><pre><code class="language-julia hljs">df = pooled!(DataFrame(design))
first(df, 5)</code></pre><div><div style = "float: left;"><span>5×6 DataFrame</span></div><div style = "clear: both;"></div></div><div class = "data-frame" style = "overflow-x: scroll;"><table class = "data-frame" style = "margin-bottom: 6px;"><thead><tr class = "header"><th class = "rowNumber" style = "font-weight: bold; text-align: right;">Row</th><th style = "text-align: left;">subj</th><th style = "text-align: left;">age</th><th style = "text-align: left;">item</th><th style = "text-align: left;">frequency</th><th style = "text-align: left;">context</th><th style = "text-align: left;">dv</th></tr><tr class = "subheader headerLastRow"><th class = "rowNumber" style = "font-weight: bold; text-align: right;"></th><th title = "String" style = "text-align: left;">String</th><th title = "String" style = "text-align: left;">String</th><th title = "String" style = "text-align: left;">String</th><th title = "String" style = "text-align: left;">String</th><th title = "String" style = "text-align: left;">String</th><th title = "Float64" style = "text-align: left;">Float64</th></tr></thead><tbody><tr><td class = "rowNumber" style = "font-weight: bold; text-align: right;">1</td><td style = "text-align: left;">S01</td><td style = "text-align: left;">old</td><td style = "text-align: left;">I01</td><td style = "text-align: left;">high</td><td style = "text-align: left;">matched</td><td style = "text-align: right;">-0.556027</td></tr><tr><td class = "rowNumber" style = "font-weight: bold; text-align: right;">2</td><td style = "text-align: left;">S02</td><td style = "text-align: left;">young</td><td style = "text-align: left;">I01</td><td style = "text-align: left;">high</td><td style = "text-align: left;">matched</td><td style = "text-align: right;">-0.444383</td></tr><tr><td class = "rowNumber" style = "font-weight: bold; text-align: right;">3</td><td style = "text-align: left;">S03</td><td style = "text-align: left;">old</td><td style = "text-align: left;">I01</td><td style = "text-align: left;">high</td><td style = "text-align: left;">matched</td><td style = "text-align: right;">0.0271553</td></tr><tr><td class = "rowNumber" style = "font-weight: bold; text-align: right;">4</td><td style = "text-align: left;">S04</td><td style = "text-align: left;">young</td><td style = "text-align: left;">I01</td><td style = "text-align: left;">high</td><td style = "text-align: left;">matched</td><td style = "text-align: right;">-0.299484</td></tr><tr><td class = "rowNumber" style = "font-weight: bold; text-align: right;">5</td><td style = "text-align: left;">S05</td><td style = "text-align: left;">old</td><td style = "text-align: left;">I01</td><td style = "text-align: left;">high</td><td style = "text-align: left;">matched</td><td style = "text-align: right;">1.77786</td></tr></tbody></table></div><p>Note that <code>simdat_crossed</code> generated a column <code>dv</code> for our dependent variable that has been pre-populated with noise from a standard normal distribution (<span>$N(0,1)$</span>). Typically, we will want to scale that, but we can do that in the simulation step. Also, this dependent variable is <em>pure noise</em>: we haven&#39;t yet added in effects. Adding in effects also comes in the simulation step.</p><p>But before we get to simulating, let&#39;s fit the model to the noise, just to see how things look. We&#39;re going to use effects coding for our contrasts.</p><pre><code class="language-julia hljs">contrasts = Dict(:age =&gt; EffectsCoding(base=&quot;young&quot;),
                 :frequency =&gt; EffectsCoding(base=&quot;high&quot;),
                 :context =&gt; EffectsCoding(base=&quot;matched&quot;))
form = @formula(dv ~ 1 + age * frequency * context +
                    (1 + frequency + context | subj) +
                    (1 + age + context | item))
m0 = fit(MixedModel, form, design; contrasts=contrasts)</code></pre><table><tr><th align="left"></th><th align="right">Est.</th><th align="right">SE</th><th align="right">z</th><th align="right">p</th><th align="right">σ_item</th><th align="right">σ_subj</th></tr><tr><td align="left">&#40;Intercept&#41;</td><td align="right">-0.0168</td><td align="right">0.0128</td><td align="right">-1.31</td><td align="right">0.1895</td><td align="right">0.0094</td><td align="right">0.0111</td></tr><tr><td align="left">age: old</td><td align="right">-0.0004</td><td align="right">0.0128</td><td align="right">-0.03</td><td align="right">0.9734</td><td align="right">0.0107</td><td align="right"> </td></tr><tr><td align="left">frequency: low</td><td align="right">0.0180</td><td align="right">0.0131</td><td align="right">1.37</td><td align="right">0.1696</td><td align="right"> </td><td align="right">0.0217</td></tr><tr><td align="left">context: unmatched</td><td align="right">0.0099</td><td align="right">0.0132</td><td align="right">0.75</td><td align="right">0.4534</td><td align="right">0.0062</td><td align="right">0.0245</td></tr><tr><td align="left">age: old &amp; frequency: low</td><td align="right">0.0014</td><td align="right">0.0131</td><td align="right">0.11</td><td align="right">0.9147</td><td align="right"> </td><td align="right"> </td></tr><tr><td align="left">age: old &amp; context: unmatched</td><td align="right">0.0068</td><td align="right">0.0132</td><td align="right">0.51</td><td align="right">0.6089</td><td align="right"> </td><td align="right"> </td></tr><tr><td align="left">frequency: low &amp; context: unmatched</td><td align="right">-0.0084</td><td align="right">0.0126</td><td align="right">-0.67</td><td align="right">0.5043</td><td align="right"> </td><td align="right"> </td></tr><tr><td align="left">age: old &amp; frequency: low &amp; context: unmatched</td><td align="right">0.0000</td><td align="right">0.0126</td><td align="right">0.00</td><td align="right">0.9972</td><td align="right"> </td><td align="right"> </td></tr><tr><td align="left">Residual</td><td align="right">1.0095</td><td align="right"></td><td align="right"></td><td align="right"></td><td align="right"></td><td align="right"></td></tr></table>
<h2 id="Assemble-the-Random-Effects"><a class="docs-heading-anchor" href="#Assemble-the-Random-Effects">Assemble the Random Effects</a><a id="Assemble-the-Random-Effects-1"></a><a class="docs-heading-anchor-permalink" href="#Assemble-the-Random-Effects" title="Permalink"></a></h2><p>The hard part in simulating right now is specifying the random effects. We&#39;re working on making this bit easier, but you need to specify the variance-covariance matrix of the random effects. You can see what this looks like:</p><pre><code class="language-julia hljs">vc = VarCorr(m0)</code></pre><table><tr><th align="left"> </th><th align="left">Column</th><th align="right"> Variance</th><th align="right">Std.Dev</th><th align="right">Corr.</th><th align="right"> </th></tr><tr><td align="left">item</td><td align="left">&#40;Intercept&#41;</td><td align="right">0.00008910</td><td align="right">0.00943915</td><td align="right"> </td><td align="right"> </td></tr><tr><td align="left"> </td><td align="left">age: old</td><td align="right">0.00011375</td><td align="right">0.01066532</td><td align="right">&#43;1.00</td><td align="right"> </td></tr><tr><td align="left"> </td><td align="left">context: unmatched</td><td align="right">0.00003830</td><td align="right">0.00618839</td><td align="right">-1.00</td><td align="right">-1.00</td></tr><tr><td align="left">subj</td><td align="left">&#40;Intercept&#41;</td><td align="right">0.00012356</td><td align="right">0.01111553</td><td align="right"> </td><td align="right"> </td></tr><tr><td align="left"> </td><td align="left">frequency: low</td><td align="right">0.00047281</td><td align="right">0.02174427</td><td align="right">&#43;1.00</td><td align="right"> </td></tr><tr><td align="left"> </td><td align="left">context: unmatched</td><td align="right">0.00060098</td><td align="right">0.02451495</td><td align="right">&#43;1.00</td><td align="right">&#43;1.00</td></tr><tr><td align="left">Residual</td><td align="left"> </td><td align="right">1.01911763</td><td align="right">1.00951356</td><td align="right"> </td><td align="right"> </td></tr></table>
<p>For each grouping variable (subjects and items), there are two major components: the standard deviations ahd the correlations.</p><p>For this example, we&#39;ll just assume all the correlations and thus the covariances are 0 in order to make things simple. Then we only have to worry about the standard deviations.</p><p>Let&#39;s assume that the variability</p><ul><li>between items<ul><li>in the intercept is 1.3 times the residual variability</li><li>in age is 0.35 times the residual variability</li><li>in context is 0.75 times the residual variability</li></ul></li><li>between subjects<ul><li>in the intercept is 1.5 times the residual variability</li><li>in frequency is 0.5 times the residual variability</li><li>in context is 0.75 times the residual variability</li></ul></li></ul><p>Note these are always specified relative to the residual standard deviation. In other words, we think about how big the between-subject and between-item differences are relative to the between-observation differences.</p><p>We can now create the associated covariance matrices.<sup class="footnote-reference"><a id="citeref-cholesky" href="#footnote-cholesky">[cholesky]</a></sup></p><pre><code class="language-julia hljs">re_item = create_re(1.3, 0.35, 0.75)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">3×3 LinearAlgebra.LowerTriangular{Float64, LinearAlgebra.Diagonal{Float64, Vector{Float64}}}:
 1.3   ⋅     ⋅ 
 0.0  0.35   ⋅ 
 0.0  0.0   0.75</code></pre><pre><code class="language-julia hljs">re_subj = create_re(1.5, 0.5, 0.75)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">3×3 LinearAlgebra.LowerTriangular{Float64, LinearAlgebra.Diagonal{Float64, Vector{Float64}}}:
 1.5   ⋅    ⋅ 
 0.0  0.5   ⋅ 
 0.0  0.0  0.75</code></pre><p>We can check that we got these right by installing these parameter values into the model.</p><pre><code class="language-julia hljs">update!(m0; subj=re_subj, item=re_item)
VarCorr(m0)</code></pre><table><tr><th align="left"> </th><th align="left">Column</th><th align="right"> Variance</th><th align="right">Std.Dev</th><th align="right">Corr.</th><th align="right"> </th></tr><tr><td align="left">item</td><td align="left">&#40;Intercept&#41;</td><td align="right">1.645411</td><td align="right">1.282736</td><td align="right"> </td><td align="right"> </td></tr><tr><td align="left"> </td><td align="left">age: old</td><td align="right">0.119268</td><td align="right">0.345352</td><td align="right">&#43;0.00</td><td align="right"> </td></tr><tr><td align="left"> </td><td align="left">context: unmatched</td><td align="right">0.547659</td><td align="right">0.740040</td><td align="right">&#43;0.00</td><td align="right">&#43;0.00</td></tr><tr><td align="left">subj</td><td align="left">&#40;Intercept&#41;</td><td align="right">2.190636</td><td align="right">1.480080</td><td align="right"> </td><td align="right"> </td></tr><tr><td align="left"> </td><td align="left">frequency: low</td><td align="right">0.243404</td><td align="right">0.493360</td><td align="right">&#43;0.00</td><td align="right"> </td></tr><tr><td align="left"> </td><td align="left">context: unmatched</td><td align="right">0.547659</td><td align="right">0.740040</td><td align="right">&#43;0.00</td><td align="right">&#43;0.00</td></tr><tr><td align="left">Residual</td><td align="left"> </td><td align="right">0.973616</td><td align="right">0.986720</td><td align="right"> </td><td align="right"> </td></tr></table>
<p>Looks good. The values don&#39;t exactly match the values in our parameter vector because the residual standard deviation isn&#39;t exactly 1.0.</p><p>For the actual simulation, we&#39;ll need the compact form of these covariance matrices that MixedModels.jl uses internally. This compact form is the parameter vector θ and we can get it back out of the model where we just installed it:</p><pre><code class="language-julia hljs">show(m0.θ)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">[1.3, 0.0, 0.0, 0.35, 0.0, 0.75, 1.5, 0.0, 0.0, 0.5, 0.0, 0.75]</code></pre><p>Alternatively, we can also just generate θ directly from the random-effects matrices:</p><pre><code class="language-julia hljs">θ = createθ(m0; subj=re_subj, item=re_item)
show(θ)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">[1.3, 0.0, 0.0, 0.35, 0.0, 0.75, 1.5, 0.0, 0.0, 0.5, 0.0, 0.75]</code></pre><p>We could also create it directly from the covariance matrices we created, but in this case we need to make sure they&#39;re in the same order as in the <code>VarCorr</code> output:</p><pre><code class="language-julia hljs">θhand = vcat( flatlowertri(re_item), flatlowertri(re_subj) )
show(θhand)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">[1.3, 0.0, 0.0, 0.35, 0.0, 0.75, 1.5, 0.0, 0.0, 0.5, 0.0, 0.75]</code></pre><div class="admonition is-warning"><header class="admonition-header">Warning</header><div class="admonition-body"><p>In storing the parameter vector θ, MixedModels.jl uses an ordering that yields maximum sparseness, which enables better computational efficiency. The ordering is thus dependent on the entirety of the design – both the choice of the random effects and the relative number of subjects and items. For this reason, we strongly recommend using the helper methods that allow specifying the grouping variable by name.</p></div></div><h2 id="Assemble-the-Fixed-Effects"><a class="docs-heading-anchor" href="#Assemble-the-Fixed-Effects">Assemble the Fixed Effects</a><a id="Assemble-the-Fixed-Effects-1"></a><a class="docs-heading-anchor-permalink" href="#Assemble-the-Fixed-Effects" title="Permalink"></a></h2><p>The last two components we need are the residual variance and the effect sizes for the fixed effects.</p><pre><code class="language-julia hljs">σ = 5;
β = [1.0, -1.0, 2.0, -1.5, 0.3, -1.3, 1.4, 0];</code></pre><p>The entries in the β correspond to the coefficients in the model given by</p><pre><code class="language-julia hljs">coefnames(m0)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">8-element Vector{String}:
 &quot;(Intercept)&quot;
 &quot;age: old&quot;
 &quot;frequency: low&quot;
 &quot;context: unmatched&quot;
 &quot;age: old &amp; frequency: low&quot;
 &quot;age: old &amp; context: unmatched&quot;
 &quot;frequency: low &amp; context: unmatched&quot;
 &quot;age: old &amp; frequency: low &amp; context: unmatched&quot;</code></pre><h2 id="Simulate"><a class="docs-heading-anchor" href="#Simulate">Simulate</a><a id="Simulate-1"></a><a class="docs-heading-anchor-permalink" href="#Simulate" title="Permalink"></a></h2><p>Now we&#39;re ready to actually simulate our data. We can use <code>parametricbootstrap</code> to do this: the parametric bootstrap actually works by simulating new data from an existing model and then looking at how the estimates fit to that new data look. In MixedModels.jl, you can specify different parameter values, such as the ones  we made up for our fake data.</p><pre><code class="language-julia hljs"># typically we would use a lot more simulations
# but we want to be quick in this example
sim = parametricbootstrap(MersenneTwister(12321), 20, m0; β=β, σ=σ, θ=θ)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">MixedModelBootstrap with 20 samples
      parameter  min        q25         median      mean          q75        ⋯
    ┌─────────────────────────────────────────────────────────────────────────
 1  │ β1         -1.79664   -0.053643   0.312708    0.685845      1.86688    ⋯
 2  │ β2         -3.11269   -1.95453    -1.50575    -1.287        -0.404404  ⋯
 3  │ β3         0.651713   1.55415     2.10404     2.24626       2.47888    ⋯
 4  │ β4         -2.66413   -1.91465    -1.37466    -1.34444      -0.632574  ⋯
 5  │ β5         -0.519033  0.041313    0.315207    0.292365      0.544831   ⋯
 6  │ β6         -1.93195   -1.32172    -0.914209   -0.990873     -0.735804  ⋯
 7  │ β7         0.930514   1.43584     1.55431     1.60366       1.89026    ⋯
 8  │ β8         -0.107651  -0.0487993  -0.0122841  -0.000321999  0.054041   ⋯
 9  │ σ          4.93184    4.96237     5.00943     5.01465       5.06505    ⋯
 10 │ σ1         5.82462    6.244       6.52838     6.51395       6.70905    ⋯
 11 │ σ2         1.4006     1.73083     1.81814     1.7934        1.86468    ⋯
 12 │ σ3         3.21113    3.41969     3.60164     3.68955       3.9548     ⋯
 13 │ ρ1         -0.304399  -0.0673391  -0.0238728  -0.00615448   0.103682   ⋯
 14 │ ρ2         -0.280769  -0.133889   -0.025639   -0.0436935    0.0720842  ⋯
 15 │ ρ3         -0.17859   -0.0504068  0.022198    0.0146995     0.087991   ⋯
 16 │ σ4         5.34141    6.83697     7.21402     7.17868       7.55147    ⋯
 17 │ σ5         1.71548    2.26589     2.39412     2.38782       2.50665    ⋯
 ⋮  │     ⋮          ⋮          ⋮           ⋮            ⋮            ⋮      ⋱
</code></pre><p>As mentioned above, the ordering within θ is dependent on the entire design, so if you embed the simulation code in a loop iterating over different numbers of subjects and items, it&#39;s probably better to write it as:</p><pre><code class="language-julia hljs">sim = parametricbootstrap(MersenneTwister(12321), 20, m0;
                          β=β, σ=σ, θ=createθ(m0; subj=re_subj, item=re_item))</code></pre><h2 id="See-your-power-and-profit!"><a class="docs-heading-anchor" href="#See-your-power-and-profit!">See your power and profit!</a><a id="See-your-power-and-profit!-1"></a><a class="docs-heading-anchor-permalink" href="#See-your-power-and-profit!" title="Permalink"></a></h2><p>Finally, we can turn this into a power table:</p><pre><code class="language-julia hljs">ptbl = power_table(sim)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">8-element Vector{@NamedTuple{coefname::String, power::Float64}}:
 (coefname = &quot;age: old &amp; frequency: low&quot;, power = 0.1)
 (coefname = &quot;frequency: low &amp; context: unmatched&quot;, power = 1.0)
 (coefname = &quot;age: old&quot;, power = 0.15)
 (coefname = &quot;context: unmatched&quot;, power = 0.5)
 (coefname = &quot;(Intercept)&quot;, power = 0.15)
 (coefname = &quot;frequency: low&quot;, power = 0.7)
 (coefname = &quot;age: old &amp; context: unmatched&quot;, power = 0.35)
 (coefname = &quot;age: old &amp; frequency: low &amp; context: unmatched&quot;, power = 0.0)</code></pre><p>For nicely displaying it, we can again use <code>pretty_table</code>:</p><pre><code class="language-julia hljs">pretty_table(ptbl)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">┌────────────────────────────────────────────────┬─────────┐
│<span class="sgr1">                                       coefname </span>│<span class="sgr1">   power </span>│
│<span class="sgr90">                                         String </span>│<span class="sgr90"> Float64 </span>│
├────────────────────────────────────────────────┼─────────┤
│                      age: old &amp; frequency: low │     0.1 │
│            frequency: low &amp; context: unmatched │     1.0 │
│                                       age: old │    0.15 │
│                             context: unmatched │     0.5 │
│                                    (Intercept) │    0.15 │
│                                 frequency: low │     0.7 │
│                  age: old &amp; context: unmatched │    0.35 │
│ age: old &amp; frequency: low &amp; context: unmatched │     0.0 │
└────────────────────────────────────────────────┴─────────┘</code></pre><p>We can of course convert the row table into a DataFrame:</p><pre><code class="language-julia hljs">DataFrame(ptbl)</code></pre><div><div style = "float: left;"><span>8×2 DataFrame</span></div><div style = "clear: both;"></div></div><div class = "data-frame" style = "overflow-x: scroll;"><table class = "data-frame" style = "margin-bottom: 6px;"><thead><tr class = "header"><th class = "rowNumber" style = "font-weight: bold; text-align: right;">Row</th><th style = "text-align: left;">coefname</th><th style = "text-align: left;">power</th></tr><tr class = "subheader headerLastRow"><th class = "rowNumber" style = "font-weight: bold; text-align: right;"></th><th title = "String" style = "text-align: left;">String</th><th title = "Float64" style = "text-align: left;">Float64</th></tr></thead><tbody><tr><td class = "rowNumber" style = "font-weight: bold; text-align: right;">1</td><td style = "text-align: left;">age: old &amp; frequency: low</td><td style = "text-align: right;">0.1</td></tr><tr><td class = "rowNumber" style = "font-weight: bold; text-align: right;">2</td><td style = "text-align: left;">frequency: low &amp; context: unmatched</td><td style = "text-align: right;">1.0</td></tr><tr><td class = "rowNumber" style = "font-weight: bold; text-align: right;">3</td><td style = "text-align: left;">age: old</td><td style = "text-align: right;">0.15</td></tr><tr><td class = "rowNumber" style = "font-weight: bold; text-align: right;">4</td><td style = "text-align: left;">context: unmatched</td><td style = "text-align: right;">0.5</td></tr><tr><td class = "rowNumber" style = "font-weight: bold; text-align: right;">5</td><td style = "text-align: left;">(Intercept)</td><td style = "text-align: right;">0.15</td></tr><tr><td class = "rowNumber" style = "font-weight: bold; text-align: right;">6</td><td style = "text-align: left;">frequency: low</td><td style = "text-align: right;">0.7</td></tr><tr><td class = "rowNumber" style = "font-weight: bold; text-align: right;">7</td><td style = "text-align: left;">age: old &amp; context: unmatched</td><td style = "text-align: right;">0.35</td></tr><tr><td class = "rowNumber" style = "font-weight: bold; text-align: right;">8</td><td style = "text-align: left;">age: old &amp; frequency: low &amp; context: unmatched</td><td style = "text-align: right;">0.0</td></tr></tbody></table></div><section class="footnotes is-size-7"><ul><li class="footnote" id="footnote-cholesky"><a class="tag is-link" href="#citeref-cholesky">cholesky</a>Technically, we&#39;re creating the lower Cholesky factor of these matrices, which is a bit like the matrix square root. In other words, we&#39;re creating the matrix form of standard deviations instead of the matrix form of the variances.</li></ul></section></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../">« MixedModelsSim.jl</a><a class="docs-footer-nextpage" href="../simulation_tutorial/">Beginner Friendly Tutorial »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="auto">Automatic (OS)</option><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option><option value="catppuccin-latte">catppuccin-latte</option><option value="catppuccin-frappe">catppuccin-frappe</option><option value="catppuccin-macchiato">catppuccin-macchiato</option><option value="catppuccin-mocha">catppuccin-mocha</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.7.0 on <span class="colophon-date" title="Thursday 12 September 2024 13:29">Thursday 12 September 2024</span>. Using Julia version 1.10.5.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
